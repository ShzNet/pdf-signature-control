<header class="app-header">
  <span>PDF Sign Demo (Angular)</span>
</header>

<aside class="left-panel">
  <div class="panel-title">Create Field</div>
  <div class="form-container" style="display: flex; flex-direction: column; gap: 10px; font-size: 13px;">
    <div class="form-group">
      <label>Page</label>
      <input type="number" [(ngModel)]="newField.page" min="1" style="width: 100%;">
    </div>
    <div class="form-row" style="display: flex; gap: 5px;">
      <div class="form-group" style="flex: 1;">
        <label>X (pt)</label>
        <input type="number" [(ngModel)]="newField.x" style="width: 100%;">
      </div>
      <div class="form-group" style="flex: 1;">
        <label>Y (pt)</label>
        <input type="number" [(ngModel)]="newField.y" style="width: 100%;">
      </div>
    </div>
    <div class="form-row" style="display: flex; gap: 5px;">
      <div class="form-group" style="flex: 1;">
        <label>Width</label>
        <input type="number" [(ngModel)]="newField.width" style="width: 100%;">
      </div>
      <div class="form-group" style="flex: 1;">
        <label>Height</label>
        <input type="number" [(ngModel)]="newField.height" style="width: 100%;">
      </div>
    </div>
    <div class="form-group">
      <label>Type</label>
      <select [(ngModel)]="newField.type" style="width: 100%;">
        <option value="text">Text</option>
        <option value="html">HTML</option>
        <option value="image">Image</option>
      </select>
    </div>

    <div class="form-group">
      <label>Content</label>
      <textarea rows="3" [(ngModel)]="newField.content" style="width: 100%;"></textarea>
    </div>

    <div class="flags-row" style="display: flex; flex-wrap: wrap; gap: 10px;">
      <label>
        <input type="checkbox" [(ngModel)]="newField.moveable"> Moveable
      </label>
      <label>
        <input type="checkbox" [(ngModel)]="newField.resizable"> Resizable
      </label>
      <label>
        <input type="checkbox" [(ngModel)]="newField.deletable"> Deletable
      </label>
    </div>

    <button class="btn-primary" (click)="handleAddField()" style="margin-top: 10px;">Add Field</button>
  </div>
</aside>

<main class="main-content">
  <div class="toolbar">
    <div class="control-group">
      <button (click)="prevPage()" title="Previous Page">◀</button>
      <span id="page-info" style="min-width: 80px; text-align: center;">{{ pageInfo }}</span>
      <button (click)="nextPage()" title="Next Page">▶</button>
    </div>

    <div class="divider"></div>

    <div class="control-group">
      <button (click)="zoomOut()" title="Zoom Out">−</button>
      <span id="zoom-info" style="min-width: 50px; text-align: center;">{{ zoomInfo }}</span>
      <button (click)="zoomIn()" title="Zoom In">+</button>
    </div>

    <div class="divider"></div>

    <div class="control-group">
      <select [(ngModel)]="viewMode">
        <option value="scroll">Scroll Mode</option>
        <option value="single">Single Page</option>
      </select>
    </div>
  </div>

  <div class="pdf-container">
    <lib-pdf-sign-angular [src]="pdfUrl" [viewMode]="viewMode" [pdfLoaderOptions]="pdfLoaderOptions" [fields]="fields"
      (ready)="onControlReady($event)" (pageChange)="onPageChange($event)" (scaleChange)="onScaleChange($event)"
      (fieldsChange)="onFieldsChange($event)" (error)="onError($event)"
      style="width: 100%; height: 100%; display: block;"></lib-pdf-sign-angular>
  </div>
</main>

<aside class="right-panel">
  <div class="properties-panel">
    <div class="panel-title">Signature Fields</div>
    <div class="field-list" style="display: flex; flex-direction: column; gap: 8px;">
      <div *ngIf="fields.length === 0" style="color: #999; font-size: 12px; font-style: italic; padding: 10px;">
        No fields yet
      </div>

      <div *ngFor="let field of fields; let i = index" class="field-item"
        style="padding: 10px; border: 1px solid #dee2e6; border-radius: 4px; font-size: 12px; margin-bottom: 5px; background: white;">

        <div style="font-weight: bold; margin-bottom: 5px; display: flex; justify-content: space-between;">
          <span>{{ i + 1 }}. {{ field.type | uppercase }} (P{{ field.pageIndex + 1 }})</span>
          <button
            style="padding: 2px 5px; font-size: 10px; background: #ff4d4f; color: white; border: none; border-radius: 3px;"
            (click)="removeField(field.id)">X</button>
        </div>

        <!-- Content Editor -->
        <div style="margin-bottom: 5px;">
          <label style="font-size: 10px; margin-bottom: 2px;">Content</label>
          <input type="text" [(ngModel)]="field.content" (ngModelChange)="refreshFields()"
            style="width: 100%; padding: 4px; font-size: 11px;">
        </div>

        <!-- Rect Editor -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-bottom: 5px;">
          <div>
            <label style="font-size: 10px; margin-bottom: 2px;">X</label>
            <input type="number" [(ngModel)]="field.rect.x" (ngModelChange)="refreshFields()"
              style="width: 100%; padding: 4px; font-size: 11px;">
          </div>
          <div>
            <label style="font-size: 10px; margin-bottom: 2px;">Y</label>
            <input type="number" [(ngModel)]="field.rect.y" (ngModelChange)="refreshFields()"
              style="width: 100%; padding: 4px; font-size: 11px;">
          </div>
          <div>
            <label style="font-size: 10px; margin-bottom: 2px;">W</label>
            <input type="number" [(ngModel)]="field.rect.width" (ngModelChange)="refreshFields()"
              style="width: 100%; padding: 4px; font-size: 11px;">
          </div>
          <div>
            <label style="font-size: 10px; margin-bottom: 2px;">H</label>
            <input type="number" [(ngModel)]="field.rect.height" (ngModelChange)="refreshFields()"
              style="width: 100%; padding: 4px; font-size: 11px;">
          </div>
        </div>

        <!-- Props Checkboxes -->
        <div style="display: flex; gap: 8px; font-size: 10px;">
          <label>
            <input type="checkbox" [(ngModel)]="field.draggable" (ngModelChange)="refreshFields()"> Drag
          </label>
          <label>
            <input type="checkbox" [(ngModel)]="field.resizable" (ngModelChange)="refreshFields()"> Resize
          </label>
        </div>
      </div>
    </div>

    <div style="margin-top: 20px; border-top: 1px solid #ddd; padding-top: 10px;">
      <div style="font-size: 11px; font-weight: bold; margin-bottom: 5px;">Model Sync Test</div>
      <button class="btn-secondary" (click)="addExternalField()"
        style="width: 100%; font-size: 11px; padding: 5px; background: #6c757d; color: white; border: none; border-radius: 4px;">
        + Add via Props (External)
      </button>
      <div style="font-size: 10px; color: #666; margin-top: 5px;">
        Adds a field by modifying the <code>fields</code> prop directly.
      </div>
    </div>
  </div>
</aside>