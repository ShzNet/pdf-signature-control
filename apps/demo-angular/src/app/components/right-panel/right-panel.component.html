<aside style="width: 100%; height: 100%;">
    <div class="properties-panel">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <div class="panel-title" style="margin: 0;">Fields</div>
            <button *ngIf="fields.length > 0"
                style="font-size: 11px; padding: 4px 8px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;"
                (click)="onClearAll()">
                Clear All
            </button>
        </div>
        <div class="field-list" style="display: flex; flex-direction: column; gap: 8px;">
            <div *ngIf="fields.length === 0" style="color: #999; font-size: 12px; font-style: italic; padding: 10px;">
                No fields yet
            </div>

            <div *ngFor="let field of fields; let i = index" class="field-item"
                style="padding: 10px; border: 1px solid #dee2e6; border-radius: 4px; font-size: 12px; margin-bottom: 5px; background: white;">

                <div style="font-weight: bold; margin-bottom: 5px; display: flex; justify-content: space-between;">
                    <span>{{ i + 1 }}. {{ field.type | uppercase }} (P{{ field.pageNumber }})</span>
                    <button
                        style="padding: 2px 5px; font-size: 10px; background: #ff4d4f; color: white; border: none; border-radius: 3px;"
                        (click)="onRemove(field.id)">X</button>
                </div>

                <!-- Props Checkboxes -->
                <div style="display: flex; gap: 8px; font-size: 10px;">
                    <label>
                        <input type="checkbox" [(ngModel)]="field.draggable" (ngModelChange)="onUpdate()"> Drag
                    </label>
                    <label>
                        <input type="checkbox" [(ngModel)]="field.resizable" (ngModelChange)="onUpdate()"> Resize
                    </label>
                </div>

                <!-- Field Details -->
                <div style="margin-top: 5px; color: #666; font-size: 10px;">
                    <div>x: {{ field.rect.x | number:'1.0-0' }}, y: {{ field.rect.y | number:'1.0-0' }}</div>
                    <div>w: {{ field.rect.width | number:'1.0-0' }}, h: {{ field.rect.height | number:'1.0-0' }}</div>
                </div>

                <!-- Live Preview -->
                <div *ngIf="(field.type === 'signature' || field.type === 'html') && field.content"
                    style="margin-top: 5px; border: 1px solid #eee; width: 100%; aspect-ratio: 3/2; overflow: hidden; display: flex; justify-content: center; align-items: center;">
                    <iframe [srcdoc]="sanitizer.bypassSecurityTrustHtml(field.content)"
                        style="width: 100%; height: 100%; border: none; pointer-events: none; transform: scale(0.8); transform-origin: center;"></iframe>
                </div>

                <div *ngIf="field.type === 'image' && field.content"
                    style="margin-top: 5px; max-height: 60px; overflow: hidden; border: 1px solid #eee; display: flex; justify-content: center;">
                    <img [src]="field.content" style="max-height: 100%; max-width: 100%;">
                </div>
            </div>
        </div>
    </div>
</aside>